<html>
  <head></head>
  <body>
    <h2> Color picker</h2>
    <div class="body"></div>

    <script type="text/javascript" language="javascript">
      //<![CDATA[
        $(document).ready(function() {
            // dirty way to get which is actual gadget we are used for
            gadget_id = $(".body").parent().attr("id")
            gadget = RenderJs.GadgetIndex.getGadgetById(gadget_id);

            // define entry point which handles an url
            gadget.render = function (){
              var body = $(".body"), handler_func;

              // Default route. Redirect to color subapp
              RenderJs.RouteGadget.add("",
                                       function () {$.url.redirect('/color/');}, 1);

              handler_func = function () {
                  var i, j, k, increment = 150, page, container;
                  // Container for the selected color
                  page = "<a href='" + $.url.generateUrl("unknown") + "'>Wrong global route<a>";
                  page += "<ul style='list-style: none;'>";
                  for (i = 0; i < 256; i += increment) {
                    for (j = 0; j < 256; j += increment) {
                      for (k = 0; k < 256; k += increment) {
                        page += "<li><a style='text-decoration: none; display: block; width: 2em; " +
                          "background-color:rgb(" + i + "," + j + "," + k + ");' " +
                          "href='" + $.url.generateUrl("/color/" + i + "/" + j + "/" + k + "/") + "'" +
                          ">&nbsp;<\/a><\/li>";
                      }
                    }
                  }
                  page += "<li style='text-align: center;'><a style='text-decoration: none; display: block; width: 2em;' href='" +
                    $.url.generateUrl("/color/X/X/X") + "'>XXX<a><\/li>";
                  page += "<\/ul>";
                  page += "<div style='display: block;' class='select-color'><\/div>"
                  page += "<a href='" +  $.url.generateUrl("/gadget-one/") + "'>Gadget 1</a>";
                  page += "&nbsp;<a href='" +  $.url.generateUrl("/gadget-two/") + "'>Gadget 2</a>";
                  page += "<div class='container'></div>";
                  body.html(page);

                  // Create sub routed in the container
                  RenderJs.RouteGadget.add("/color/",
                                           function () {
                                             $('.select-color').text("Please select a color");}, 2);
                  RenderJs.RouteGadget.add("/color/<int:red>/<int:green>/<int:blue>/",
                                           function (red, green, blue) {
                                            $('.select-color').html(
                                              "<div style='background-color:rgb(" + red + "," + green + "," + blue + ");'>&nbsp;<\/div>" +
                                              "<p>Color (" + red + "," + green + "," + blue + ") selected at " + new Date() + "<\/p>");},
                                           2);
                  RenderJs.RouteGadget.go($.url.getPath(),
                                          function () {
                                            $('.select-color').html("Unknown color (" + $.url.getPath() + ")");},
                                          2);
                };

              // /color app. Create subroutes and initialize DOM
              RenderJs.RouteGadget.add("/color<path:params>", handler_func, 1);

          };
        });
      //]]>
    </script>
  </body>
</html>
